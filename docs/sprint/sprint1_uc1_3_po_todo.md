# Sprint 1 UC1.3 修复 Todo

- [x] 噪音超标兜底：在后端返回噪音/SNR 告警标志，并在设备/校准界面阻断流程或提供一键启用强降噪的指引；修复后补充单元测试覆盖阈值判断与 UI 呈现。 ✅
- [x] Fn 预热日志同步：探测开始时即写入 `Priming/PreRoll` 状态（含失败分支），确保会话时间线与提示音一致；完成后补充状态机单元测试验证。 ✅
- [x] Waveform Telemetry Bridge 帧率治理：将 `fn-preroll` 波形推送节流到 30–60fps，避免当前 500fps 事件风暴；更新后验证 VAD/波形字段仍与 400 ms SLA 提示保持一致。 ✅
- [x] 16 kHz 采样率统一：在 `capture_audio` 强制使用或重采样至 16 kHz PCM，保证预热波形、校准与会话主链路遵循架构音频基线，并补充相应单元测试。 ✅
- [x] 音频管线集成 RNNoise 降噪与自动增益控制：在后端捕获回调中串联 DSP 处理并输出到波形/诊断/持久化路径，补充单元测试保障跨平台一致性。 ✅
- [x] RNNoise 重采样整改：为 `NoiseSuppressor` 引入真实的 16 kHz→48 kHz 重采样（或改为直接 48 kHz 采集后再下采样），确保 RNNoise 获得完整频谱输入，并以端到端测试验证噪声抑制效果。 ✅

- [x] 麦克风重采样兼容：允许 44.1/48 kHz 设备进入管线，通过后台实时下采样至 16 kHz 并复用 RNNoise/AGC/Telemetry 流程，补充跨采样率单元测试后再申请验收。 ✅
- [x] 样本加密存储：为设备诊断样本与回放资源增加 HMAC/加密封装，加载前进行完整性校验，防止本地 WAV 被篡改或泄露。 ✅
- [x] 音频缓存密钥隔离：为诊断样本封装引入独立的 AES/HMAC 密钥（或基于主密钥派生子密钥），避免与配置签名共享同一 `hmac_key`，并补充密钥泄露/篡改的单元测试验证。 ✅
- [x] 诊断样本清理策略：实现封装样本的 TTL/容量治理，在写入或读取前清除过期/多余文件，确保加密缓存目录满足架构“定期清理”要求，并补充回归测试覆盖失败日志与残留场景。 ✅
- [x] 可调节帧窗口：在音频 DSP 中恢复 200 ms 默认/100 ms 回退的帧长度策略，暴露配置与遥测以满足架构关于首字延迟治理的约束。 ✅
