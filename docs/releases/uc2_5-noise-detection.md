# Release Notes — UC2.5 噪音检测与静默自动结束

## 版本概述
UC2.5 为 Flowwisper 桌面录音流程带来噪音突增提醒与静默自动结束功能。用户在录音时可即时获知环境噪音状态，并在长时间静默后自动结束会话、直接生成转写结果，减少无效录音与遗忘结束的风险。

## 关键改动
- **实时噪音条幅**：在 `PreRoll` 期间采样环境基线，录音时若噪音超过基线 15 dB 且持续 300 ms，浮层顶部出现黄色提示条，2 秒冷却防止重复弹出。
- **静默倒计时与自动结束**：当语音能量低于基线 −10 dB 持续 2 秒，浮层中央展示 3→2→1 倒计时；静默满 5 秒后自动结束并切换到“转写完成”卡片。
- **离线一致性**：噪音/静默逻辑完全在本地运行，即使离线也能显示提示并自动结束；遥测事件在本地 SQLite 队列中排队等待联网上传。
- **桌面 HUD 更新**：React 浮层新增 `NoiseBanner` 与 `SilenceCountdown` 组件，保持浅色/深色模式可读性并支持字幕模式文案。
- **遥测拓展**：记录噪音触发、静默倒计时、自动结束及取消原因，支持 QA 与数据分析回溯。

## 已知限制
- Core `cargo test` 目前因 `SessionLifecyclePayload` 未在测试作用域导入导致编译失败；功能代码可运行，但需后续补充导出/导入以恢复单测。
- 桌面 Tauri 层在 Linux CI 环境需要 `glib-2.0` 系统库，容器默认缺失导致 `cargo test --lib` 失败；本地 macOS/Windows 开发环境不受影响。
- Vitest 套件依赖 `document`/`navigator`，需在 Node 环境配置 JSDOM；当前容器未启用，导致 UI 测试失败。
- 噪音检测依赖设备可提供实时能量数据；若硬件或权限不支持，系统会降级提示“噪音检测暂不可用”，仍需用户手动结束。

## QA 建议
- 参照《tests/qa/uc2_5_noise_autostop.md》执行跨平台手册测试，重点覆盖噪音突增、静默倒计时取消、离线遥测排队等场景。
- 建议在 macOS (内建/蓝牙) 与 Windows (内建/USB) 设备上各完成至少一次全流程验证。

## 发布清单
- 更新产品文档：《docs/architecture.md》《docs/voice_fn_transcriber_prd.md》描述噪音检测流程与 UI 交互。
- 提供 QA 清单：`tests/qa/uc2_5_noise_autostop.md`。
- 记录已知测试失败项，安排后续修复或在 CI 中配置所需依赖。
