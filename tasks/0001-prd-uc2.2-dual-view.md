# PRD: UC2.2 原始稿与润色稿双视图展示

## 1. 概述
Flowwisper Fn 语音输入助手需要在桌面端语音浮层中同时呈现原始转写与 AI 润色稿，并让普通桌面用户在录音过程中即时理解内容状态并进行句级切换。本 PRD 目标是基于 Sprint 2 的 UC2.2，将实时双视图展示落地到可执行需求，确保 400ms 内出现原始稿增量、2.5 秒内可用的润色稿，以及对“保留口语感，仅做轻量语法修正”的润色风格支持。

## 2. 目标
1. 在语音录制浮层中同步呈现原始稿与润色稿，保证原始稿首批文本在 400ms 内出现，润色稿首句在 2.5 秒内可用。
2. 支持用户在右侧润色稿列表中多选句子并恢复为原始稿，必要时可逐句切换。
3. 将润色风格固定为轻量语法修正、保留口语感，并在 UI 中给予明显标识。
4. 提供状态与延迟反馈，帮助用户理解当前文本是否仍在处理中或已经稳定。
5. 仅在本地记录 UI/管线延迟及错误日志，满足最小可观测性要求。

## 3. 用户故事
- 作为一名桌面端普通终端用户，我希望在说话时立即看到原始转写和稍后出现的润色文本，这样我能确认系统已经正确理解我的语句。
- 作为一名桌面端普通终端用户，我希望可以一次选择多句润色稿恢复为原始稿，以便在需要保留原始语气时快速调整。
- 作为一名桌面端普通终端用户，我希望系统默认输出自然口语化的润色结果，仅修正语法或标点，从而保持我原有的表达风格。
- 作为一名桌面端普通终端用户，当润色稿生成较慢或失败时，我希望看到明显提示，以便判断是否继续等待或改用原始稿。

## 4. 功能性需求
1. **双列布局展示**：语音浮层左列显示原始稿增量文本，右列显示润色稿；两列均需按句/时间段分块，并保持滚动同步。
2. **原始稿刷新机制**：前端每 200ms 接收 Core Service 推送的原始文本增量，并在首批数据到达时更新 UI；若 400ms 内无数据需展示“仍在转写”占位。
3. **润色稿生成与刷新**：Core Service 在收到稳定句段（VAD 或标点判断）后 0.5 秒内向前端推送润色结果；若超出 2.5 秒则附带延迟警示标记。
4. **多选恢复交互**：在润色稿右列提供复选框或批量选择模式，支持一次选择最多 5 句恢复为原始稿；恢复动作需即刻替换对应句段，并在 200ms 内同步至 Core Service。
5. **逐句切换**：润色稿块支持悬浮操作按钮“恢复原始”，单击即可切换该句；再次点击可回退到润色版本。
6. **风格指示与配置**：润色列顶部展示“口语风格 · 轻量语法修正”标签，用户可点击了解说明但不可在本 Use Case 中修改；如未来支持切换，需要跳转到设置页。
7. **延迟与状态提示**：
   - 当润色生成中时，在对应句块显示旋转进度或“润色中”占位。
   - 超过 2.5 秒仍未完成时，显示黄色提示并提供“继续等待/恢复原始”操作。
   - 若润色失败，展示错误状态并默认回退至原始稿，同时在通知中心记录。
8. **对齐插入与导出**：完成会话后，默认以润色稿为插入文本；若用户恢复部分句子，插入时需使用更新后的混合文本，并保留句间顺序。
9. **本地日志记录**：在 Core Service 与前端记录以下事件（本地文件或系统日志）：
   - 原始稿首字延迟、润色首句延迟（成功/失败）。
   - 润色超时次数、批量恢复操作。
   - 关键错误（如润色服务不可用、消息队列超时）。
10. **可访问性**：确保键盘可访问（Tab、空格/回车触发多选与恢复），并支持屏幕阅读器朗读左右列标题与状态。

## 5. 非目标
- 本迭代不提供润色风格切换、模板化润色或自定义程度调整。
- 不实现历史记录页面的双视图展示（仅限实时浮层）。
- 不接入云端日志或遥测上报，仅保留本地日志文件。
- 不引入会话摘要或片段库增强展示逻辑。

## 6. 设计考量
- UI 双列布局需继承现有浮层样式，参考 `voice_fn_transcriber_wireflow` 中的实时展示结构；保持 60fps 动画与状态色彩一致。
- 原始稿采用单色等宽字体，润色稿可使用更易读的比例字体并标注句间分隔线。
- 多选模式建议使用右列顶部“批量恢复”开关进入，避免误触；选中状态需明显高亮并统计已选句数。
- 延迟提示采用 HUD 规范颜色：绿色=正常、黄色=警告、红色=失败（参考架构文档的状态 HUD 约定）。

## 7. 技术考量
- Core Service 需提供原始稿与润色稿的独立流式通道（或在消息中标识 type），确保前端能按句粒度渲染。
- 润色引擎默认使用本地轻量模型或云端 GPT-4o mini streaming；若网络不佳需自动降级为本地规则润色并通知前端。
- 句级稳定判定依赖 Whisper 解码帧与 VAD 状态；至少要等待一句出现标点或静默超过 300ms 才推送到润色队列。
- 多选恢复操作需向 Core Service 回传事件，以便会话结束时生成正确的最终文本并写入历史/剪贴板。
- 本地日志可复用现有 `telemetry` 模块，新增事件类型 `dual_view_latency`、`dual_view_revert` 等；日志滚动保留最近 7 天。

## 8. 成功指标
- 95% 会话中原始稿首批文本延迟 ≤ 0.4s。
- 90% 句段的润色结果在 2.5s 内可用，超时率 ≤ 10%。
- 批量恢复功能的误触率（撤销/取消次数）≤ 5%，并在可用性测试中获得 ≥ 4/5 的易用性评分。
- 相关 bug 回报率（与双视图展示相关）在上线后前两周内 < 2% 活跃会话。

## 9. 未解问题
- 是否需要在设置中提供“默认展示哪一列”或“自动滚动行为”配置？
- 润色延迟提示的提示语与视觉样式是否需要 UX 进一步确认？
- 本地日志的保存路径与可用容量上限是否需要由 Infra 团队评审？
